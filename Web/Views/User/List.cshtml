@model Web.ViewModels.UserListViewModel
@{
    ViewBag.Title = "SearchUser";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Search for a friend</h2>

@using (Html.BeginForm("Search", "Users", FormMethod.Post, new {@class = "form-inline"}))
{
    <div class="form-group">
        <div class="input-group">
            @Html.TextBoxFor(s => s.Query, new {@class = "form-control", placeholder = "Search"})
            <div class="input-group-addon">
                <i class="glyphicon glyphicon-search"></i>
            </div>
        </div>
    </div>
}
@if (Model.IsSearched)
{
    <table class="table">

        <tr>
            <th>
                Name
            </th>
            <th>
                
            </th>
        </tr>

        @foreach (var user in Model.Users)
        {
            <tr>
                <td>
                    <a href="@Url.Action("Details", "Users", new {id = user.Id})">
                        @user.FirstName @user.LastName
                    </a>
                </td>
                <td>
                    <a href="#" class="js-user-send-friend-request" data-user-id="@user.Id">
                        Send friend request
                    </a>
                </td>
            </tr>
        }
    </table>
}

@section scripts
{
    <script>
        $(document).ready(function() {
            $(".js-user-send-friend-request").click(function(e) {
                var button = $(e.target);
                if (confirm("Are you sure? Delete action is permanent.")) {
                    $.ajax({
                            url: "/api/user/" + button.attr("data-user-id"),
                            method: "POST"
                        })
                        .done(function() {
                            alert("Your request has been sent!");
                        })
                        .fail(function() {
                            alert("Something went wrong!");
                        });
                }
            });
        })
    </script>
}
